---
title: "SLB"
date: 2019-04-04T15:32:45+09:00
weight: 300
draft: false
---

## 一般仕様	
#### Q. レイヤー4とレイヤー7のSLBの違いについて
SLBはレイヤ4 (TCP、UDP)およびレイヤ7(HTTP、HTTPS)を提供しています。

レイヤ 4 SLB は、ロードバランシングを実現するために keepalived のオープンソースソフトウェアの Linux 仮想サーバー（ LVS ）を使用し、クラウドコンピューティングの要件に応じて、いくつかのカスタマイズを行っています。
レイヤ 7 SLB は、ロードバランシングを実現するために Tengine を使用しています。 Tengine、Nginx に基づいて Web サーバープロジェクトは、多量トラフィックのウェブサイトに対応する機能を追加しています。
#### Q. SLBのアクセスログについて
SLBのレイヤ7のアクセスログは提供しています。

アクセスログの取得は下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/85974.htm
#### Q. SLBのスペック変更方法と業務影響について
コンソールにて、SLBのスペック変更をオンラインで実施することができます。また、トラフィックが流れている状態でAPIよりSLBのスペックを変更することもできます。

ただし、スペックを変更している時に、SLBサービスが中断されることあります。スペックの変更が完了になると、SLBが自動的に再開します。

なお、SLBのスペック変更は「パフォーマンス専有型」から「パフォーマンス専有型」へのインスタンススペック変更、もしくは、「パフォーマンス共通型」から「パフォーマンス専有型」へのインスタンススペック変更となります。「パフォーマンス専有型」から「パフォーマンス共通型」へのスペック変更はできません。

スペックの変更は下記のドキュメントをご参照ください。 
https://jp.alibabacloud.com/help/doc-detail/85942.htm
#### Q. VServerグループとマスタースレーブグループの違いについて
Vserverグループを利用した場合、ディレクトリ転送機能を利用できます。
転送設定されてないディレクトリの場合、デフォルトバックエンドサーバーに分散されます。

デフォルトグループまたは、Vserverグループにて重みを0に設定してもマスタースレーブ構成になりませんので、マスタースレーブグループを利用する必要があります。

VServerグループは下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/85964.htm
マスタースレーブグループは下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/85965.htm
#### Q. サードパーティ証明書のアップロード方法について
SLBにサードパーティ証明書をアップロードすることができます。

アップロード方法は下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/85971.htm 
#### Q. SLB関連の各API のスロットリング上限について
SLBでは、AccessKey１つあたりのAPI呼び出し回数を１日に5000回まで制限されます。

Server Load Balancer プロダクトの制限をご参照ください。 
https://jp.alibabacloud.com/help/doc-detail/32459.htm

## ネットワーク	
#### Q. パブリックSLBとプライベートSLBの違いについて
パブリックSLBはインターネットからのリクエストを受け取るため、パブリックIPアドレスを提供しています。AlibabaCloudの仕様として、パブリックSLBがVPC内にあるバックエンドECSと通信できますが、該当VPCのプライベートIPアドレスを持っていません。

プライベートSLBはパブリックIPアドレスを提供しておらず、Alibaba Cloud イントラネットからのリクエストのみ受信できます。AlibabaCloudの仕様として、プライベートSLBはVPCのプライベートIPを持っています。
なお、プライベートSLBにEIPを付与することにより、パブリックSLBとして機能することもできます。
#### Q. パブリックSLBとバックエンドECS間の通信仕様について
パブリックSLBとバックエンドECS間はプロクシ通信となります。該当通信は、ECSのセキュリティグループで遮断できない仕様となります。

SLBのアーキテクチャは下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/27544.htm
#### Q. パブリックIPとプライベートIP付きSLBの作成方法について
パブリックSLBにプライベートIPがない仕様に対して、プライベートIPとパブリックIP両方が必要の場合、プライベートSLBにEIPをバインド機能を利用して実現できます。

作成手順
1. 先にイントラネット型のSLBを作成します。
2. 作成したSLBにEIPをバインドします。
#### Q. ホワイトリストとブラックリストについて
SLBはホワイトリストとブラックリスト方式でアクセスを制御しています。

ホワイトリストとブラックリストの設定方法は下記のドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/85979.htm
#### Q. SLBのインバウンド/アウトバウンド帯域幅について
SLBのインターネット通信帯域幅はコンソール上で表示されている値に準じます。

日本リージョン：インバウンド: 1024Mbps、アウトバウンド: 1024Mbps
中国リージョン：インバウンド: 5120Mbps、アウトバウンド: 5120Mbps
#### Q. 証明書をSLB側とECS側に設置の違いについて
証明書の設置場所により、SSL通信空間は違います。

証明書をSLB側に設置：　クライアント ---> SLB の間の通信はHTTPSで行います。(SLB-->ECSはHTTPで行います。)
証明書をECS側に設置： SLB ---> バックエンドECS の間の通信はHTTPSで行います。

なお、証明書をSLB側に設置した場合、SLBとECS間にHTTP通信のみ設定可能な仕様になります。
#### Q. TCP over SSLの対応について
日本サイトのSLB現在レイヤー4のTCP over SSLを対応していません。SSL通信が必要な場合、レイヤー7のHTTPSを利用する必要があります。

## 負荷分散
#### Q. ラウンドロビン利用時に分散されない事象について
SLBの仕様上、セッションの保持時間内に再度SLBアクセスを実施すると 保持されているセッションにアクセスするため、
重みと剥離してアクセスが偏ったことがあります。

実際にセッションの切り替えを確認する方法は下記となります。
・リスナー設定（HTTP）の場合 　
リスナー設定で「セッションの保持」を無効にし、リロードすることで確認できます。 
・リスナー設定（TCP）の場合 　
リスナー設定の「接続タイムアウト」で最小値の10秒と設定し、10秒以上の間隔でリロードすることで確認できます。 
#### Q. バックエンドECSの重み設定について
SLBのバックエンドECSの重みの仕組みは下記となります。

例えば ECS インスタンス A の重みを 10 に設定し、ECS インスタンス B の重みを 100 に設定した場合、インスタンス A には総アクセス数の 10/(10+100)％ が転送され、インスタンス B は 100/(10+100)％ が転送されます。 
#### Q. APIでVserverグループ追加時の引数書き方について
APIでVServerグループを操作する際に、引数に「\」を利用する必要がります。

■バックエンドサーバを追加
aliyun slb AddBackendServers --RegionId ap-northeast-1 --LoadBalancerId SLB_ID --BackendServers [{\"ServerId\"\:\"instance_ID\"\,\"Weight\"\:\"100\"}]

■バックエンドサーバを削除
aliyun slb RemoveBackendServers --LoadBalancerId SLB_ID --BackendServers [{\"ServerId\"\:\"instance_ID\"\}]
#### Q. SLBの相互認証について
SLBでは相互認証のアクセス方式に対応しています。

相互認証の設定方法は下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/54508.htm

なお、SLBの仕様では現在失効リストに対応していません。
#### Q. SLBを利用したsorryサーバーの実装方法について
SLB自体はsorryサーバーの実装に対応していませんが、DNSの機能GTM(Global Traffic Management)を利用すれば、Sorryサーバーの切り替えを実現することができます。

GTMの概要は下記ドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/86630.htm

## ヘルスチェック
#### Q. SLBのヘルスチェック頻度の仕様について
SLBヘルスチェックの頻度はコンソール上で設定可能です。設定方法は以下のドキュメントを参照してください。
https://jp.alibabacloud.com/help/doc-detail/85959.htm

なお、監視の信頼性を向上するため、複数台の監視サーバーから同時にヘルスチェックするような仕様となっています。コンソール上のヘルスチェック間隔設定は、1台の監視サーバーに対する設定値となりますので、結果的には、設定値より多いチェックが発生してしています。
#### Q. SLBのヘルスチェック用CIDRブロックについて
SLBのヘルスチェック用CIDRは下記となります。
・100.64.0.0./10

ヘルスチェックは下記のドキュメントをご参照ください。
https://jp.alibabacloud.com/help/doc-detail/55205.htm
