<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Terraform on テクニカルリファレンス</title>
    <link>https://sbcloud.github.io/help/best-practice/devops/terraform/</link>
    <description>Recent content in Terraform on テクニカルリファレンス</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>ja-jp</language>
    <lastBuildDate>Wed, 15 May 2019 10:37:37 +0900</lastBuildDate>
    
	<atom:link href="https://sbcloud.github.io/help/best-practice/devops/terraform/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title>Terraformとは</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/01/how-to-use/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/01/how-to-use/</guid>
      <description>&amp;nbsp; AlibabaCloudというクラウドサービスが登場したことで、クラウドサービス上にあるECSという仮想コンピューティングを作成・破棄するのが非常に簡単になりました。ボタン一つで数分でコンピューティングを起動できます。AlibabaCloudのマネジメントコンソールはWeb上にて操作する、数多くの機能をまとめた完成度の高いGUIです。
&amp;nbsp; しかし、Web上にてGUI操作とはいえ設定項目を一つ一つずつ画面上操作するのは骨が折れるのと、小規模サービスでも構築にヒューマンエラーや運用・学習コストはどうしても付き物になります。例えばAlibabaCloud未経験者がECSをCS 100台を手動起動してみましょう。この作業にどれほどの時間がかかるか、そしてミスをゼロにして稼働できるか、という課題があります。そこで解決の道となったのがInfrastructure as Code（以降は「IaC」と略します）です。
&amp;nbsp; IaCはコード通りの内容を自動で設定する仕組みを持ちます。IaCの種類はPackerやVagrantなど様々ですが、HashiCorp社がオープンソースとして手掛けるTerraformというマルチクラウド対応プロビジョニングツールがあります。シンプルなDSL(HCL)、自由自在な変数表現と状態管理が特徴です。
&amp;nbsp; TerraformはAlibabaCloudだけでなくAmazon Web Services 、GoogleCloudPlatform、MicrosoftAzure、Docker、OpenStackなど様々なインフラに幅広く対応しています。インフラを構築するためのプロビジョニングツールであり、開発者だけなく、運用担当者でも必要となりうるプロビジョニングツールです。
&amp;nbsp; Terraformは構築したいインフラの構成をテキスト形式のテンプレートファイルに定義します（Infrastructure as Code）。「どこのリージョン」「どのスペックのECS、どのリソースを使うか」「支払い方法」「展開方法」といったインフラの状態をコードとして記述し、ターミナルからコマンドを実行するだけでクラウド上に適用 (構築) が出来ます。逆に既存のリソースをTerraformでImportすることでコード化、同じ構成のコードを他リージョンで同様展開することも可能です。 他にIaCとしてPackerやVagrantがありますが、本ガイドラインとしてはTerraformを中心とした説明で進めます。 &amp;nbsp; 構成変更や他クラウドプロパイダからのマイグレーション、同じリソースで別リージョン、別アカウントにて展開するときにIaCがあることでエラーなくシームレスに移管ができます（リソースをGUIベースでコピーすることは不可能です。） また障害や高負荷など問題発生時でも環境を復元することができるメリットもあります。
&amp;nbsp; 加えて、コードからリソースを作成することで学習コスト・運用コストを削減することができます。例えば先ほどの例、AlibabaCloud未経験者がECS 100台を手動でなくIaC、Terraformで起動すると、ミスをゼロへ抑制はもちろん、学習工数・運用保守コスト・全てが大幅に節約できます。
&amp;nbsp; また、クラウド環境（仮想環境）が登場したことで、サーバらHW、物理的リソース制約がなくなりました。これにより、サーバやネットワークを簡単に構築したり、一旦構築したものをすぐに破棄することが出来るようになったので、一度構築したインフラやリソースは変更を加えることなく破棄して、新しいものを構築する考えが可能になりました。 →このような流れは「Immutable Infrastructure（不変のインフラ）」と呼ばれ、インフラ変更履歴を管理するのではなく、動作している「インフラの状態」を管理（=必要に応じて使い捨て）からクラウド環境ではコードによるインフラ構成・構築・管理・運用を行う必要があります。
&amp;nbsp; 前置きが長くなりましたが、クラウドサービスの良いところは立案した戦略や設計をすぐに試せれるところであり、AlibabaCloudの良いところは、PaaS/IaaS/SaaS/KaaS&amp;hellip;幅多くのプロダクトサービスがあり、これらの活用によってより楽に生産的にすることができる点です。是非楽しみながらAlibabaCloudのTerraformを読み進めていただければ大変幸いです。</description>
    </item>
    
    <item>
      <title>インストール</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/02/install/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/02/install/</guid>
      <description>本章は Terraform のインストール方法を学びます。
 ※ Mac/Linuxでのインストール方法になります。Windows版でのTerraform導入方法は別途記載予定です。 ※ Terraformバージョン違いを防止するためにtfenvで管理をする方法がありますが、これとは別に Dockerを使った方法もありますので参考にしてください。
 1. Homebrew &amp;nbsp; Terraformは前章で説明した通り、HashiCorp社がオープンソースとして展開してるツールです。基本的にはバージョンアップに 追従しやすい tfenv の利用を推奨しますが、お試しであればHomebrew も手軽です。 macOS の場合は次のように、Homebrew を使ってインストールできます。
$ brew install terraform $ terraform --version Terraform v0.11.13  
2. tfenv tfenvは Terraformのバージョン管理マネージャです。 tfenvを使うことで、異なるバージョンのTerraformを差異なく利用できます。
$ brew install tfenv $ tfenv --version tfenv 0.6.0  完了したら、インストール可能なTerraform のバージョンを確認します。
$ tfenv list-remote 0.12.0-beta1 0.11.13 ・・・  最新の安定バージョンかつAlibabaCloud Terraform対応は 0.11.13です。0.11.13を次のようにインストールします。
$ tfenv install 0.11.13  terraformには .terraform-versionというファイルがあり、こちらにバージョンを記述すると、そのバージョンを自動的にインストールできます。
$ echo 0.11.13 &amp;gt; .</description>
    </item>
    
    <item>
      <title>サンプルプロジェクトの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/03/sample-project/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/03/sample-project/</guid>
      <description>&amp;nbsp; ここまででTerraform のインストール方法を学びました。それではサンプルプロジェクトを作成します。簡単なWebサーバを立ち上げながら、Terraformの流れや中身を確認します。 1. ディレクトリ・ファイル構成 &amp;nbsp; Terraformのファイルの拡張子は *.tf です。実行時、同じディレクトリの *.tf ファイルがマージされますので、基本は以下3ファイルに分けてそれぞれの用途・目的に応じた記載・運用がベターです。
main.tf … モジュールが内包するリソース、データソースなどの定義 outputs.tf … モジュールが出力するAttributeの定義 variables.tf … モジュールが受け取る変数の定義  main.tf には どのプロパイダを使うかを記載します。 階層化は任意ですが、.tfから別のフォルダの.tfに記載されてる変数を取り出すためにルートディレクトリを指定することがありますのでそこは注意が必要です。apply (=実行) にて分離実行することも可能です。 例えば以下のようにプロダクトサービス毎にフォルダを作成し、それぞれのリソースを作成しても、最終的には一つへまとめれます。
├── main.tf ├── output.tf ├── variables.tf │ ├── region │├── VPC ││├── main.tf ││├── output.tf ││└── variables.tf ││ │├── ECS ││├── main.tf ││├── output.tf ││└── variables.tf ・ ・ ・  &amp;nbsp; RAMなど他者へ渡したくない情報がある場合、別途設定ファイル（ confing.tfvars など）へ記載し、実行時は -var-file引数で 設定ファイルを読み取り実行することができます。
├── main.tf ├── output.tf ├── variables.</description>
    </item>
    
    <item>
      <title>サンプルプロジェクトの実行</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/04/run-terraform/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/04/run-terraform/</guid>
      <description>&amp;nbsp; 前章は 簡単なWebサーバを立ち上げるというサンプルプロジェクトを作成しました。今章はサンプルプロジェクトを実行しつつ、Terraformの流れや中身を確認します。
Terraformの実行は非常にシンプルです。以下図のようにterraform initから始まり、terraform play、terraform applyでリソース作成を実行します。

1. terraform init &amp;nbsp; コードを書いたら「terraform init」コマンドを実行します。このコマンドはTerraformの実行に必要なプロパイダーのバイナリをダウンロードしてくれます。「Terraform has been successfully initialized!」と表示されていれば作業ディレクトリ構成的にOKです。
$ terraform init Initializing provider plugins... ・・・ Terraform has been successfully initialized!  
2. terraform plan 次は「terraform plan」コマンドです。 RAMなどの情報を別途設定ファイル confing.tfvars へ記載した場合は以下のコマンドで実行します。
$ terraform plan -var-file=&amp;quot;confing.tfvars&amp;quot; Refreshing Terraform state in-memory prior to plan... The refreshed state will be used to calculate this plan, but will not be persisted to local or remote state storage.</description>
    </item>
    
    <item>
      <title>Terraform文法について</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/05/program-syntax/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/05/program-syntax/</guid>
      <description>&amp;nbsp; 前章は 簡単なWebサーバを立ち上げるというサンプルプロジェクトを実行しました。うち、Terraformには様々な記載文法がありますので、把握した方がいい部分だけ説明します。

1. Configuration Syntax &amp;nbsp; Terraformのコード構成要素、コードの構成文の書き方です。Terraformの利用ガイドラインに沿って記載してみてください。Terraformのバージョンによっては書き方が異なる場合がありますので、注意が必要です。
# project_nameを宣言 variable &amp;quot;project_name&amp;quot; { } /* alicloud_vpcを設定 変数project_nameを呼び出す */ resource &amp;quot;alicloud_vpc&amp;quot; &amp;quot;vpc&amp;quot; { name = &amp;quot;${var.project_name}-vpc&amp;quot; cidr_block = &amp;quot;192.168.1.0/24&amp;quot; }   単一行コメントは#をつけます。 複数行コメントは/*と*/で囲みます。 文字列は二重引用符で囲みます。 文字列は${}を使って他の構文や値を補間できます。 ${var.foo}。 数字は10進数で扱います。数字の前に英数字を付けると、例えば0xでも16進数として扱われます。 ブール値が使え、true、falseのどれかになります。 プリミティブ型のリストは角括弧（[]）で作成できます。例：[&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;, &amp;quot;baz&amp;quot;] マップは中括弧（{}）とコロン（:） で作成できます。例：{ &amp;quot;foo&amp;quot;: &amp;quot;bar&amp;quot;, &amp;quot;bar&amp;quot;: &amp;quot;baz&amp;quot; } キーが数字で始まっていない限り、キーでは引用符を省略できます。その場合は、引用符が必要です。単一行マップでは、キーと値のペアの間にコンマが必要です。複数行マップではキーと値のペアの間の改行で十分です。  他、構成文の書き方もありますが、ひとまずは上記のを抑えれば大抵問題ないです。

2. Interpolation Syntax &amp;nbsp; 変数・関数・属性など、コード補充機能です。
 ユーザ文字列変数 var.接頭辞とそれに続く変数名を使用します。たとえば${var.foo} で foo変数値を補間します。
 ユーザーマップ変数 構文はvar.MAP[&amp;quot;KEY&amp;quot;]です。たとえば${var.amis[&amp;quot;us-east-1&amp;quot;]} でマップ変数us-east-1、内キーの値amisを取得します。
 ユーザリスト変数 構文は${var.</description>
    </item>
    
    <item>
      <title>Dockerについて</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/06/docker/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/06/docker/</guid>
      <description>&amp;nbsp; 前章までは Terraformのインストール方法、Terraformの文法、実行方法を説明しました。しかしこれらはTerraform v0.11.13前提での話なので、Terraformのバージョンが違うことで挙動が異なってしまうこともあります。Terraformでよく使うメソッドが急に廃止、、というのもよくあります。それを防ぐためにdockerを使ったインストール、利用する方法があります。dockerはパッケージングを行うための技術です。
*注：Terraformのバージョン食い違いは基本的にtfenvでカバーできます。詳しくはインストールを参照してください

1. dockerについて &amp;nbsp; dockerはOS・ミドルウェア・ファイルシステム全体をイメージという単位で取り扱い、まるごとやりとり出来るツールです。また、イメージの配布やバージョン管理も可能です。メリットとして、手軽に同じ環境を何人のユーザ・ユーザ・他のマシンでも手に入れることができ、即座に同環境を再現（ CI (Continuous Integration) 継続的インテグレーションと CD (Continuous Delivery) 継続的デリバリー ）することができます。 また、dockerはTerraformで大きく３つの役割があり、Terraformのインストールや実行環境の再現、各種リソースの接続設定、docker Imageを使った既存のプロダクトリソースをそのまま導入することが可能です。（docker Imageとは、dockerコンテナを作成する際に必要となるファイルシステムです。）

2. dockerのTerraform位置について &amp;nbsp; Terraformによるdockerの利用は大きく2パターンあります。
 1.Terraformのバージョン違いなど環境差分を抑えつつ実行する場合 2.Terraformで新規作成した各種リソースの接続設定をする場合 3.docker-imageを使った、CI/CD:継続的インテグレーションと継続的デリバリーをする場合  ざっくりですがこんなイメージです。 &amp;nbsp; 1はバージョン固定や実行環境を汚さずに使用するメリットがあります。様々な環境でterraformを使用したい場合は直接terraformコマンドをインストールせず、バージョン管理が可能なツール(tfenv)を使用してインストールすルことを勧めます。 &amp;nbsp; 2はTerraformで新規作成したリソースに対し、docker-compose.yml ファイルを使ってアプリケーションの環境を設定します。こちらは公式サイトにて説明がありますので参考にしてください。 http://docs.docker.jp/compose/overview.html
&amp;nbsp; 3は、dockerのImageファイルをdocker hub（リポジトリ）へ保存することで、新規ECSや各種アプリケーション、Webサイトを立ち上げる時、docker hub（リポジトリ）から対象のDocker ImageファイルをPullしそのまま実行することで、どの環境でも継続CI/CDを実現することができます。
本章はTerraformをメインとしてるため、ここにCI/CDや方法は載せませんが、やり方は以下サイトを参照してみてください。（近日中にCI/CD手法を載せる予定です）
Dockerize App and Push to Container Registry: CI/CD Automation on Container Service (1)
Continuous Deployment Automation on Alibaba Cloud: CI/CD Automation on Container Service (2)</description>
    </item>
    
    <item>
      <title>Moduleについて</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/07/module/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/07/module/</guid>
      <description>&amp;nbsp; これまでTerraformの書き方を学びました。しかし問題があります。それはvariableによる変数宣言が多すぎると、可読性も下がり、場合によっては何度も同じ内容を書く必要があったりします。それを防ぐために、他のプログラミング言語と同じくモジュール化があります。

1. Moduleとは &amp;nbsp; Terraformにおけるmoduleは各resourceを抽象化するためのものです。以下の例を見てみましょう。モジュール化されてないソースと、モジュール化されてないソースを見てください。
モジュール化されてないソース variable &amp;quot;region&amp;quot; { default = &amp;quot;ap-northeast-1&amp;quot; } variable &amp;quot;solution_name&amp;quot; { default = &amp;quot;Web-Application-for-Terraform&amp;quot; } variable &amp;quot;web_layer_name&amp;quot; { default = &amp;quot;Web&amp;quot; } variable &amp;quot;web_availability_zone&amp;quot; { default = &amp;quot;a&amp;quot; } resource &amp;quot;alicloud_instance&amp;quot; &amp;quot;web&amp;quot; { instance_name = &amp;quot;${var.web_layer_name}&amp;quot; availability_zone = &amp;quot;${var.region}${var.web_availability_zone}&amp;quot; ・・・ ・・・ }  resourceの中に変数のプレースホルダを置き、さらにその変数名を variableで変数宣言し呼び出ししてしまいます。それを抑えるのがmoduleです。
モジュール化されてるソース variable &amp;quot;region&amp;quot; { value = &amp;quot;ap-northeast-1&amp;quot; } variable &amp;quot;solution_name&amp;quot; { value = &amp;quot;Web-Application-for-Terraform&amp;quot; } variable &amp;quot;web_layer_name&amp;quot; { value = &amp;quot;Web&amp;quot; } variable &amp;quot;web_availability_zone&amp;quot; { value = &amp;quot;a&amp;quot; } module { source = &amp;quot;.</description>
    </item>
    
    <item>
      <title>VPCの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/08/vpc/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/08/vpc/</guid>
      <description>&amp;nbsp; ここまではTerraformのインストール方法、コード記載方法、実行方法を説明しました。
ここからはユーザ各自でコード作成、応用ができるよう、AlibabaCloudの基本プロダクトサービスの説明を通じて解説します。
1. VPC &amp;nbsp; VPCは、Alibaba Cloudに設置されたプライベートネットワークです。 VPCはAlibaba Cloudの他のアカウントを含む仮想ネットワークと論理的に分離されています。
&amp;nbsp; VPCはAlibaba Cloud でお客様専用のプライベートネットワークです。 CIDRというIPアドレス範囲の指定で経路、ルートテーブルとネットワークゲートウェイの設定など、VPCを完全に制御できます。VPC環境があることで、ECS、RDS、SLBなど外部インターネットからアクセスしないAlibaba Cloudリソースを使用することができます。
&amp;nbsp; システムをセキュアにするため、パブリックネットワークには必要最小限のリソースのみ配置し、それ以外はプライベートネットワークに置くのがベストプラクティスです。

2. コンポーネント &amp;nbsp; VPCは、CIDRブロック、VRouter、及びVSwitchで構成されます。
・CIDRブロック・・・IPアドレスの空間を指定することで通信経路を出す設定情報。プライベートIPアドレス範囲をCIDR（Classless Inter-Domain Routing）ブロックの形式で指定する必要があります。 ・VRouter・・・VPCのハブ。VPC内の各VSwitchを接続でき、ゲートウェイとしてもVPCを他のネットワークに接続することもできます。 ・VSwitch・・・VPCの基本的なネットワークデバイス、様々なクラウド製品インスタンスに接続するために使用されます。
VPCコンポーネントは以下のような構成図になります。 
また、VPC作成には以下の通り制限事項がありますので、注意が必要です。
   リソース デフォルトの制限 クォータ量の増減     各リージョンでの最大VPC数 10    使用可能なCIDRブロックの範囲 192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8,及びそのサブセット サポートセンターまでお問い合わせください   VPC 内の VRouter の最大数 1 申請不可   VPC 内の VSwitch の最大数 24 サポートセンターまでお問い合わせください   VPC 内のルータテーブルの最大数 1 申請不可   ルータテーブル内のルートエントリの最大数 48 サポートセンターまでお問い合わせください   VPCで実行できるクラウド製品インスタンスの最大数 15,000 申請不可    参考:VPC使用制限</description>
    </item>
    
    <item>
      <title>ECS、EIPの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/09/ecs/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/09/ecs/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるECS、EIPの作成方法を解説します。
1. ECS &amp;nbsp; ECSは、Alibaba Cloudによる仮装コンピューティングサービスです。ECS インスタンスは、ECS のコアコンポーネントであり、CPU、メモリ、およびその他の基本的なコンピューティングコンポーネントを含む仮想コンピューティング環境です。ディスク、イメージ、スナップショットなどの他のリソースは、ECS インスタンスと組み合わせてのみ使用できます。 &amp;nbsp; Alibaba CloudのECSはビジネスやWebアプリケーションなど様々なニーズに対応しており、即時に作れることが特徴です。
&amp;nbsp; ECSインスタンス生成リソースは多くのオプション（任意）でパラメータや構成を指定できます。ECSインスタンスはVPCやセキュリティグループとは少し異なり、OSやバージョン選定、起動時データ引き渡しやECS使い捨て利用など様々な利用方法が実現出来るため、ここは抑えておきましょう。

2. ECSインスタンス生成のTerraformについて &amp;nbsp; 本題、ECSインスタンス生成作成に移ります。ECSインスタンス生成するだけの簡単なソースを作ってみます。
resource &amp;quot;alicloud_instance&amp;quot; &amp;quot;ECS_instance&amp;quot; { instance_name = &amp;quot;ECS_instance_for_terraform&amp;quot; host_name = &amp;quot;ECS_instance_for_terraform&amp;quot; instance_type = &amp;quot;ecs.n4.small&amp;quot; image_id = &amp;quot;centos_7_06_64_20G_alibase_20190218.vhd&amp;quot; system_disk_category = &amp;quot;cloud_efficiency&amp;quot; security_groups = [&amp;quot;${alicloud_security_group.sg.id}&amp;quot;] availability_zone = &amp;quot;${var.zone}&amp;quot; vswitch_id = &amp;quot;${alicloud_vswitch.vsw.id}&amp;quot; }  alicloud_instance  instance_name - （オプション）ECSインスタンスの名前。このパラメータを指定しない場合、デフォルト名のECS-Instanceを自動生成します。 host_name - （オプション）ECSのホスト名。 instance_type - （必須）起動するインスタンスの種類。 image_id - （必須）ECSインスタンスに使用するイメージ。ECSインスタンスのイメージは image_idを変更することで置き換えることができます。  image_idの種類や取得方法は後述します。
 system_disk_category - （オプション）ストレージの種類。有効な値はcloud_efficiency 、 cloud_ssd 、およびcloudです。デフォルトはcloud_efficiency。 security_groups - （必須）関連付けるセキュリティグループIDのリスト。 availability_zone - （オプション）インスタンスを起動するゾーン。 vswitch_id - （オプション）接続したいVSwitchのID。 user_data - （オプション）ユーザーデータ。起動直後、実行したいコマンドがあればこちらにて入れます。  このalicloud_instanceリソースを実行することにより、以下の属性情報が出力されます。</description>
    </item>
    
    <item>
      <title>SLBの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/10/slb/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/10/slb/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるSLBの作成方法を解説します。
1. SLB &amp;nbsp; SLB（Server Load Balancer）はアプリケーションや Web サイトのトラフィックを分散させるサービスです。
&amp;nbsp; SLB は、仮想サービスアドレスを設定することによって、追加の ECS インスタンスを高性能で可用性の高いアプリケーションサービスプールに仮想化し、クライアントからのリクエストを、 転送ルールに従ってサーバープール内のECS インスタンスに分配します。
&amp;nbsp; また、SLB は、追加されたバックエンドサーバーの状態をチェックし、異常状態の ECS インスタンスを自動的に分離します。そうすることで SPOF (単一障害点) 問題を除去し、アプリケ ーションの全体的なサービス性能を向上させます。 それに加え、Alibaba Anti-DDoS と組み合わせることで、SLB は DDoS 攻撃を防御することができます。

2. コンポーネント &amp;nbsp; SLBは以下のコンポーネントが含まれています。
 SLB インスタンス SLB インスタンスは、実行中の負荷分散サービスで、着信トラフィックをバックエンドサーバーに分配します。 負荷分散サービスを使用するには、SLB インスタンスを作成します。インスタンスには少なくとも 1 つのリスナーと 2 つのバックエンドサーバーを設定する必要があります。
 リスナー リスナーはクライアントからのリクエストをチェックし、設定されたルールに基づいてバックエンドサーバーに転送します。 また、バックエンドサーバーのヘルスチェックも実行します。
 バックエンドサーバー バックエンドサーバーは、分散リクエストを処理するために SLB インスタンスに追加された ECS インスタンスです。 分散リクエストを処理する ECSインスタンスは、デフォルトサーバーグループ、VServer グループ、アクティブ/スタンバイサーバーグループのいずれかに追加することができます。
  またServer Load Balancer (SLB) は、 ECS インスタンスの単一障害点 (SPOF)、アクティブゾーンの障害、などを防ぐ役割がありますので、SLBを組み合わせることでサービスの高可用性を実現することができます。</description>
    </item>
    
    <item>
      <title>AutoScalingの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/11/autoscaling/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/11/autoscaling/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるAutoscalingの作成方法を解説します。
1. AutoScaling &amp;nbsp; Auto Scaling はECSリソースの容量を自動的にスケールイン/スケールアウト調整してくれます。 ※ESSとは、SDK名やパッケージ名で用いられるAuto Scalingの略称です。（Elastic Scaling Service）

2. コンポーネント &amp;nbsp; VPCは、CIDRブロック、VRouter、及びVSwitchで構成されます。
・スケールアウト ECSリソースが増加した際、自動的にECSインスタンスが作成されるので、アクセス遅延や過度のリソース負荷を回避できます。 ・スケールイン ビジネスニーズに伴い、基盤となるECAリソースが低下した場合、自動的にECSインスタンスが削除され、リソースの無駄を省いてくれます。 ・柔軟なリカバリ 異常なECSインスタンスを検知し、自動的にリリースされ、代わりに新規ECSインスタンスが作成されます。 3. AutoScalingのTerraformについて &amp;nbsp; 本題、AutoScaling作成に移ります。以下の構成図通り、簡単なソースを作ってみます。
resource &amp;quot;alicloud_ess_scaling_group&amp;quot; &amp;quot;scaling&amp;quot; { min_size = 2 max_size = 10 scaling_group_name = &amp;quot;tf-scaling&amp;quot; vswitch_ids=[&amp;quot;${alicloud_vswitch.vsw. *.id}&amp;quot;] loadbalancer_ids = [&amp;quot;${alicloud_slb.slb. *.id}&amp;quot;] removal_policies = [&amp;quot;OldestInstance&amp;quot;, &amp;quot;NewestInstance&amp;quot;] depends_on = [&amp;quot;alicloud_slb_listener.http&amp;quot;] } resource &amp;quot;alicloud_ess_scaling_configuration&amp;quot; &amp;quot;config&amp;quot; { scaling_group_id = &amp;quot;${alicloud_ess_scaling_group.scaling.id}&amp;quot; image_id = &amp;quot;ubuntu_140405_64_40G_cloudinit_20161115.vhd&amp;quot; instance_type = &amp;quot;ecs.n2.small&amp;quot; security_group_id = &amp;quot;${alicloud_security_group.default.id}&amp;quot; active=true enable=true user_data = &amp;quot;#!</description>
    </item>
    
    <item>
      <title>OSSの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/12/oss/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/12/oss/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるObject Storage Serviceの作成方法を解説します。
1. OSS &amp;nbsp; Object Storage Service （OSS）は、クラウド内の任意の量のデータの保存、バックアップ、およびアーカイブを可能にするストレージサービスです。

2. コンポーネント &amp;nbsp; OSSはTerraform モジュールを使用して、バケットとオブジェクトを管理できます。 例として、
 バケット管理機能 バケットの作成 バケットの ACL を設定 バケットに CORS (Cross-Origin Resource Sharing) を設定 バケットのログ記録を設定 バケットの静的 Web サイトホスティングを設定 バケットのリファラを設定 バケットのライフサイクルルールを設定 オブジェクト管理機能 オブジェクトをアップロード オブジェクトのサーバー側の暗号化を設定 オブジェクトに ACL を設定 オブジェクトメタを設定  などが上げられます。

3. OSSのTerraformについて &amp;nbsp; 本題、OSS作成に移ります。プライベートバケットを作成するという簡単なソースを作ってみます。
resource &amp;quot;alicloud_oss_bucket&amp;quot; &amp;quot;bucket-acl&amp;quot;{ bucket = &amp;quot;bucket-170309-acl&amp;quot; acl = &amp;quot;private&amp;quot; }  alicloud_oss_bucket  bucket - （オプション）バケットの名前。 acl - （任意）ACL。デフォルトは &amp;ldquo;private&amp;rdquo;。  他、OSSに関してはalicloud_oss_bucketだけで色々なリソース作成が可能です。例えば以下の例があります。</description>
    </item>
    
    <item>
      <title>RDSの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/13/rds/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/13/rds/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるRelation Database Serviceの作成方法を解説します。
1. RDS &amp;nbsp; Relation Database Service （RDS）は、ApsaraDB for RDS 、クラウド内の独立したデータベースサービスです。
2. コンポーネント &amp;nbsp; ApsaraDB for RDSシリーズとしてMySQL、SQL Server、PostgreSQL、PPASがあります。
・ApsaraDB for MySQL・・・MySQL。現状5.5、5.6、5.7をサポートしています。
・ApsaraDB for SQL Server・・・SQL Server。2008 R2 EE、2012 のWeb/Standard/EE、2016 のWeb/Standard/EEをサポートしています。
・ApsaraDB for PostgreSQL・・・PostgreSQL。9.4をサポートしています。
・ApsaraDB for PPAS・・・Postgres Plus Advanced Server （ PPAS ）、Oracle Database互換性機能があります。現在バージョン 9.3 をサポートしています。
3. RDSのTerraformについて &amp;nbsp; 本題、RDS作成に移ります。ApsaraDB for MySQLというインスタンスを作成し、databaseをセット、アカウントを作成する内容です。
resource &amp;quot;alicloud_db_instance&amp;quot; &amp;quot;default&amp;quot; { engine = &amp;quot;MySQL&amp;quot; engine_version = &amp;quot;5.6&amp;quot; instance_type = &amp;quot;rds.mysql.t1.small&amp;quot; instance_storage = 5 vswitch_id = &amp;quot;${var.</description>
    </item>
    
    <item>
      <title>RAMの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/14/ram/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/14/ram/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるResource Access Managementの作成方法を解説します。
1. RAM権限管理 &amp;nbsp; AlibabaCloudはどのサービスを利用・操作するにしろ権限が必要です。 Terraformで作成したリソースサービスにも他ユーザが操作できるように権限アタッチが必要になります。 &amp;nbsp; 本章では、AlibabaCloudサービスに対する権限付与の方法を学びます。

2. Alibaba CloudのRAMについて &amp;nbsp; RAM（Resource Access Management）はユーザーID の管理とアクセス制御、権限管理のためのサービスです。RAMを使用することで、ユーザーアカウント (従業員、システム、アプリケーションなど) を作成および管理し、Alibaba Cloud アカウントのリソースに対してそのユーザーアカウントが所有する操作権限を制御できます。Terraformによるリソースを実行するときはRAMで実行権限が必須です。

3. RAMロールとRAMユーザーの違い  RAMロールは仮想ID であり、固定のIDは持っていますが、ID認証情報アクセスキーを持ちません。 RAMユーザは、固定のIDとID認証アクセスキーを持つ実際のIDであり、一般的には、特定のユーザーまたはアプリケーションに対応します。  graph LR; A(&amp;#34;ポリシーサービスに&amp;lt;br&amp;gt;対する権限&amp;#34;)-.-&amp;gt;B(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;ロールにアタッチ&amp;#34;) A(&amp;#34;ポリシーサービスに&amp;lt;br&amp;gt;対する権限&amp;#34;)-.-&amp;gt;C(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;ユーザにアタッチ&amp;#34;) B(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;ロールにアタッチ&amp;#34;)-.-&amp;gt;D(&amp;#34;ロール(役割)&amp;#34;) C(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;ユーザにアタッチ&amp;#34;)-.-&amp;gt;E(&amp;#34;ユーザ(人)&amp;#34;) D(&amp;#34;ロール(役割)&amp;#34;)-.-&amp;gt;F(&amp;#34;ロール(役割)を&amp;lt;br&amp;gt;エンティティ(ECSインスタンスなど）にアタッチ&amp;#34;) A(&amp;#34;ポリシーサービスに&amp;lt;br&amp;gt;対する権限&amp;#34;)-.-&amp;gt;G(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;グループにアタッチ&amp;#34;) G(&amp;#34;RAMポリシーを&amp;lt;br&amp;gt;グループにアタッチ&amp;#34;)-.-&amp;gt;H(&amp;#34;グループ（ユーザの集まり）&amp;#34;) &amp;nbsp; RAMロールは権限が付与された実際のユーザーが引き受ける必要があります。ロールを引き受けると実際のユーザーはこのRAMロールの一時セキュリティトークンを受け取ります。これにより、この一時セキュリティトークンを使用して、ロールに許可されているリソースにアクセスできます。
&amp;nbsp; 普段の利用時はRAMユーザで管理・運用していくのがベストプラクティスですが、Terraform利用時は基本的にAdministratorAccessが必要となります。
4. ポリシー &amp;nbsp; 権限はポリシーで定義します。ポリシーでは「実行可能なアクション」や「操作可能なリソース」を指定でき、柔軟に権限が設定できます。
5. ポリシードキュメント &amp;nbsp; ポリシードキュメントはJSON形式で管理しており、以下のようにまとめます。 ▼JSON 形式のポリシードキュメント
{ &amp;quot;Statement&amp;quot;: [ { &amp;quot;Action&amp;quot;: &amp;quot;*&amp;quot;, &amp;quot;Effect&amp;quot;: &amp;quot;Allow&amp;quot;, &amp;quot;Resource&amp;quot;: &amp;quot;*&amp;quot; } ], &amp;quot;Version&amp;quot;: &amp;quot;1&amp;quot; }  ポリシードキュメントでは、次のような要素を記述します。 * Effect - 許可する場合はAllow、許可しない場合はDeny * Resource - AlibabaCloudの操作可能なリソース・許可されたオブジェクトはなにかを指定します。たとえば ”ユーザAがリソースSampleBucketに対してGetBucket操作を実行できる” という権限付与ポリシーの場合、ResourceはSampleBucket です。 * Action - AlibabaCloudの各種サービスでどんな操作が実行できるか。サービスを個別指定することも可能。たとえば ”ユーザAがリソースSampleBucketに対してGetBucket操作を実行できる” という権限付与ポリシーの場合、ActionはGetBucket です。 * Condition - 権限付与が有効になる条件です。たとえば、”ユーザAが2018年12月31日より前にリソース SampleBucketに対してGetBucket操作を実行できる” という権限付与ポリシーの場合、Conditionは 2018年12月31日より前 です。</description>
    </item>
    
    <item>
      <title>Kubernetesの作成</title>
      <link>https://sbcloud.github.io/help/best-practice/devops/terraform/15/kubernetes/</link>
      <pubDate>Mon, 01 Jul 2019 00:00:00 +0900</pubDate>
      
      <guid>https://sbcloud.github.io/help/best-practice/devops/terraform/15/kubernetes/</guid>
      <description>AlibabaCloudの基本プロダクトサービスであるResource Access Managementの作成方法を解説します。
1. Kubernetes &amp;nbsp; Kubernetesは自動デプロイ、スケーリング、アプリ・コンテナの運用自動化のために設計されたオープンソースのプラットフォームです。Kubernetesによって、以下のことが要求に迅速かつ効率良く対応ができます。
 アプリを迅速に予定通りにデプロイする (コンテナをサーバー群へ展開する) 稼働中にアプリをスケールする（稼働中にコンテナ数を変更する） 新機能をシームレスに提供開始する (稼働中にロールアウトする) ハードウェアの利用率を要求に制限する (コンテナで共存させて稼働率を高くする）  &amp;nbsp; Kubernetesのゴールは、下記の様なアプリの運用負担を軽減するためのエコシステムのコンポーネントとツールを整備することです。
 可搬性: パブリック・クラウド、プライベート・クラウド、ハイブリッド・クラウド、マルチ・クラウド 拡張可能: モジュール化、追加可能、接続可能、構成可能 自動修復: 自動配置、自動再起動、自動複製、自動スケーリング  &amp;nbsp; 2014年にプロジェクトが開始され、運用経験を基に、本番のワークロードを大規模に実行し、コミュニティのベストプラクティスのアイデアやプラクティスと組み合わせています。 Kubernetesの事例は https://kubernetes.io/case-studies/ にあります。
&amp;nbsp; またAlibabaのKubernetesサービスは非常に便利な上、Container Clustor、kubernetes managed、Container Registryと各方面へ進化段階なので、随時チェックするといいでしょう。

2. コンポーネント &amp;nbsp; Container Service for Kubernetes はネイティブの Kubernetes をベースに構成、拡張されています。 このサービスは、クラスターの作成および拡張を容易に行うことができ、Alibaba Cloud の機能である、仮想化、ストレージ、ネットワーク、セキュリティ、およびKubernetes コンテナー化したアプリケーションの高品質な実行環境を統合することができます。
3. KubernetesのTerraformについて &amp;nbsp; 本題、Kubernetesクラスタ作成に移ります。AZシングルゾーンのKubernetesクラスタを生成するだけの簡単なソースを作ってみます。
resource &amp;quot;alicloud_cs_kubernetes&amp;quot; &amp;quot;main&amp;quot; { name_prefix = &amp;quot;my-first-k8s&amp;quot; availability_zone = &amp;quot;${data.alicloud_zones.default.zones.0.id}&amp;quot; new_nat_gateway = true master_instance_types = [&amp;quot;ecs.</description>
    </item>
    
  </channel>
</rss>